# Terraform Module: core_resource_group

## Overview

This module provisions a "governed" Azure Resource Group. It is a foundational component responsible for creating a logical container for resources while enforcing key organizational governance policies.

Instead of just creating an empty resource group, this module provides a standardized way to manage its lifecycle and the policies that apply to all resources within it.

### Key Features

- **Standardized Naming**: Automatically generates a compliant resource group name using the central `utils/naming` module.
- **Deletion Protection**: Optionally applies a `CanNotDelete` lock to prevent accidental deletion of critical environments.
- **Tag Inheritance Policy**: Optionally assigns an Azure Policy to ensure all child resources automatically inherit tags from this resource group, enforcing consistent cost tracking and management.

---

<!-- This section is automatically generated by terraform-docs. Do not edit it directly. -->
<!-- To update, run 'terraform-docs' in this directory. -->
<!-- BEGIN_TF_DOCS -->

## Requirements

| Name                                                                     | Version |
| ------------------------------------------------------------------------ | ------- |
| <a name="requirement_terraform"></a> [terraform](#requirement_terraform) | ~> 1.12 |
| <a name="requirement_azurerm"></a> [azurerm](#requirement_azurerm)       | ~> 4.45 |

## Providers

| Name                                                         | Version |
| ------------------------------------------------------------ | ------- |
| <a name="provider_azurerm"></a> [azurerm](#provider_azurerm) | ~> 4.45 |

## Modules

| Name                                                  | Source             | Version |
| ----------------------------------------------------- | ------------------ | ------- |
| <a name="module_naming"></a> [naming](#module_naming) | ../../utils/naming | n/a     |
| <a name="module_tags"></a> [tags](#module_tags)       | ../../utils/tags   | n/a     |

## Resources

| Name                                                                                                                                                                      | Type        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| [azurerm_management_lock.delete_lock](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/management_lock)                                    | resource    |
| [azurerm_resource_group.this](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group)                                             | resource    |
| [azurerm_resource_group_policy_assignment.inherit_tags](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/resource_group_policy_assignment) | resource    |
| [azurerm_role_assignment.policy_identity_tag_contributor](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/role_assignment)                | resource    |
| [azurerm_policy_definition.inherit_tag_from_rg](https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/data-sources/policy_definition)                     | data source |

## Inputs

| Name                                                                                                                     | Description                                                                                                                          | Type          | Default | Required |
| ------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------ | ------------- | ------- | :------: |
| <a name="input_custom_tags"></a> [custom_tags](#input_custom_tags)                                                       | A map of custom tags to be applied to the resource group, in addition to the mandatory tags. Keys should be in lowercase snake_case. | `map(string)` | `{}`    |    no    |
| <a name="input_customer_code"></a> [customer_code](#input_customer_code)                                                 | A short and unique code representing the customer or context for this resource group. This value is passed to the naming module.     | `string`      | n/a     |   yes    |
| <a name="input_enable_delete_lock"></a> [enable_delete_lock](#input_enable_delete_lock)                                  | If set to true, a 'CanNotDelete' lock will be applied to the resource group to prevent accidental deletion.                          | `bool`        | `false` |    no    |
| <a name="input_enable_tag_inheritance_policy"></a> [enable_tag_inheritance_policy](#input_enable_tag_inheritance_policy) | If set to true, assigns policies to inherit ALL tags from this resource group.                                                       | `bool`        | `false` |    no    |
| <a name="input_environment"></a> [environment](#input_environment)                                                       | The official full name of the environment for this resource group. This value is passed to the naming module.                        | `string`      | n/a     |   yes    |
| <a name="input_location"></a> [location](#input_location)                                                                | The official full Azure location name for this resource group. This value is passed to the naming module.                            | `string`      | n/a     |   yes    |
| <a name="input_role"></a> [role](#input_role)                                                                            | A short name describing the function or role of this resource group. This value is passed to the naming module.                      | `string`      | n/a     |   yes    |

## Outputs

| Name                                                        | Description                                 |
| ----------------------------------------------------------- | ------------------------------------------- |
| <a name="output_id"></a> [id](#output_id)                   | The ID of the created resource group.       |
| <a name="output_location"></a> [location](#output_location) | The location of the created resource group. |
| <a name="output_name"></a> [name](#output_name)             | The name of the created resource group.     |
| <a name="output_tags"></a> [tags](#output_tags)             | All tags applied to the resource group.     |

<!-- END_TF_DOCS -->

---

## Usage

This module is typically called from a `solutions` module or a `live` Terragrunt configuration to define the top-level container for a set of related resources.

### Basic Example (`simple`)

This demonstrates creating a simple resource group for a development environment, with advanced governance features disabled.

```hcl
module "basic_rg" {
  source = "../../foundations/core_resource_group"

  location      = "japaneast"
  customer_code = "gaixer"
  role          = "dev-apps"
  environment   = "development"

  # Governance features are disabled by default
  enable_delete_lock              = false
  enable_tag_inheritance_policy = false
}
```

### Full-Featured Example (`full-featured`)

This demonstrates creating a resource group for a production environment, with all governance features enabled.

```hcl
module "production_rg" {
  source = "../../foundations/core_resource_group"

  location      = "japaneast"
  customer_code = "gaixer"
  role          = "prod-platform"
  environment   = "production"

  # Enable protection and governance for production
  enable_delete_lock              = true
  enable_tag_inheritance_policy = true

  # The policy will inherit all tags defined below
  custom_tags = {
    cost_center         = "IT-PROD-12345"
    data_classification = "Confidential"
  }
}
```

## Important Considerations

- **Policy Definition**: The tag inheritance feature relies on a pre-existing, built-in Azure Policy Definition named "Inherit a tag from the resource group". This module only handles the _assignment_ of the policy.
- **Policy Identity Permissions**: When `enable_tag_inheritance_policy` is `true`, this module automatically creates a Managed Identity for the policy assignment and grants it the `Tag Contributor` role on the resource group's scope.

## Examples

For fully functional, runnable examples that demonstrate both simple and full-featured use cases, please see the [`examples/`](./examples/) directory.