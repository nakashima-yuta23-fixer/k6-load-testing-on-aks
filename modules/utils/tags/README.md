# Terraform Module: utils/tags

## Overview

This utility module is the **single source of truth for standardized resource tagging**. It takes basic context variables (like environment and role) and generates a consistent map of tags that should be applied to resources.

The primary purpose of this module is to enforce a consistent tagging strategy across all infrastructure, which is crucial for cost management, operations, and governance. It also provides a mechanism to merge these standard tags with any resource-specific custom tags.

This module does not create any resources itself.

---

<!-- This section is automatically generated by terraform-docs. Do not edit it directly. -->
<!-- To update, run 'terraform-docs' in this directory. -->
<!-- BEGIN_TF_DOCS -->

## Requirements

No requirements.

## Providers

No providers.

## Modules

No modules.

## Resources

No resources.

## Inputs

| Name                                                                     | Description                                                                                                                              | Type          | Default | Required |
| ------------------------------------------------------------------------ | ---------------------------------------------------------------------------------------------------------------------------------------- | ------------- | ------- | :------: |
| <a name="input_custom_tags"></a> [custom_tags](#input_custom_tags)       | A map of any additional, custom tags to be merged with the standard tags. Custom tags will override standard tags if keys conflict.      | `map(string)` | `{}`    |    no    |
| <a name="input_customer_code"></a> [customer_code](#input_customer_code) | A short unique code representing the customer or context (e.g., 'gaixer'). This is used to populate the 'customer_code' tag.             | `string`      | n/a     |   yes    |
| <a name="input_environment"></a> [environment](#input_environment)       | The full name of the environment (e.g., 'development'). This is used to populate the 'environment' tag.                                  | `string`      | n/a     |   yes    |
| <a name="input_role"></a> [role](#input_role)                            | A short name describing the primary function of the resource (e.g., 'platform-rg', 'app-vnet'). This is used to populate the 'role' tag. | `string`      | n/a     |   yes    |

## Outputs

| Name                                                  | Description                                                                    |
| ----------------------------------------------------- | ------------------------------------------------------------------------------ |
| <a name="output_result"></a> [result](#output_result) | The final, merged map of standard and custom tags to be applied to a resource. |

<!-- END_TF_DOCS -->

---

## Usage

This module is intended to be called from within `foundations` modules that create taggable Azure resources.

### Basic Example

Below is a typical example of how to invoke this module inside another module (e.g., `core_resource_group`).

```hcl
# In a foundations module's main.tf

# Define variables that will be passed to the tags module
variable "customer_code" { type = string }
variable "role" { type = string }
variable "environment" { type = string }
variable "custom_tags" { type = map(string), default = {} }

# Call the central tags module
module "tags" {
  source = "../../utils/tags"

  customer_code = var.customer_code
  role          = var.role
  environment   = var.environment
  custom_tags   = var.custom_tags
}

# Then, use the output to set the tags on your resource
resource "azurerm_resource_group" "this" {
  name = "rg-example"
  # ...
  tags = module.tags.result
}
```

## Tagging Strategy

This module generates a base set of standard tags and merges them with any provided custom tags.

- **Standard Tags**: The module automatically creates tags like `managed_by`, `customer_code`, `environment`, and `role`. The format and keys of these tags are centrally managed within this module.
- **Custom Tags**: You can pass a map of additional tags via the `custom_tags` variable.
- **Merge Behavior**: If a tag key exists in both the standard tags and custom tags, the value from the **`custom_tags` map will take precedence**.

## Important Note on Azure Policy

In our architecture, while this module prepares the tags, the final enforcement and inheritance of tags on child resources are typically handled by **Azure Policy**, which is assigned at the resource group level (by the `core_resource_group` module).

Therefore, this module is primarily used to set the initial, standardized tags on top-level resources like Resource Groups.
